@{
    Layout = "~/Views/_LayoutPage.cshtml";

    ViewBag.Title = "在线投稿";
}
@section scripts{
    <script src="../../Scripts/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.unobtrusive-ajax.js" type="text/javascript"></script>
    
    <link href="../../Res/Index/css/online.css" rel="stylesheet" type="text/css" />
    <script src="../../Res/Admin/js/jquery.js" type="text/javascript"></script>
    <script src="../../Res/Admin/js/jquery.idTabs.min.js" type="text/javascript"></script>
    <script src="../../Res/Admin/js/select-ui.min.js" type="text/javascript"></script>
    <link href="../../kindeditor-4.1.7/plugins/code/prettify.css" rel="stylesheet" type="text/css" />
    <script src="../../kindeditor-4.1.7/kindeditor-min.js" type="text/javascript"></script>
    <script charset="utf-8" src="../../kindeditor-4.1.7/kindeditor.js" type="text/javascript"></script>
    <link href="../../kindeditor-4.1.7/themes/default/default.css" rel="stylesheet" type="text/css" />
    <script charset="utf-8" src="../../kindeditor-4.1.7/plugins/code/prettify.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.form.js" type="text/javascript"></script>
    <script charset="utf-8" src="../../kindeditor-4.1.7/lang/zh_CN.js" type="text/javascript"></script>

<script type="text/javascript">

    KindEditor.ready(function (K) {
        var editor1 = K.create('#content7', {
            cssPath: '/kindeditor-4.1.7/plugins/code/prettify.css',
            uploadJson: '/kindeditor-4.1.7/asp.net/upload_json.ashx',
            fileManagerJson: '/kindeditor-4.1.7/asp.net/file_manager_json.ashx',
            allowFileManager: true,
            afterBlur: function () { this.sync() },
            afterCreate: function () {
                var self = this;
                self.sync();
            }
        });
        prettyPrint();
    })
    
</script>
}
<div class="base">
    <div class="container">
        <div class="content">
            <div class="row">
                <div class="main-top-img">
                    @if (ViewData["banner"] == null)
                    {
                        <img src="/images/banner/banner1.png" alt="banner1.png" style="width: 100%; height: 200px;" />
                    }
                    else
                    {
                        <img src="@ViewData["banner"]" alt="banner1.png" style="width:100%;height:200px;"/>
                    }
                </div>
            </div>
            <div class="row">
                <div class="place">
                    <span>位置：</span>
                    <ul class="placeul">
                        <li>在线投稿</li>
                    </ul>
                </div>
                <div class="formbody">
                    <div id="usual1" class="usual">
                        <div class="itab">
                            <ul>
                                <li><a href="#tab1" class="selected">在线投稿</a></li>
                            </ul>
                        </div>
                        <div id="tab1" class="tabson">
                            @*<div class="formtext">
                    添加<b>@ViewData["Msg"]</b>新闻！</div>*@
                            @using (Ajax.BeginForm("OnlineSubmission", new { }, new AjaxOptions() { HttpMethod = "post", OnSuccess = "AfterSuccess" }, new { id = "form1" }))
                            {                                                                    
                                <ul class="forminfo">
                                    <li>
                                        <label>
                                            新闻名称<b>*</b></label><input name="Title" type="text" class="dfinput" style="width: 518px;" /></li>
                                    <li>
                                        <label>
                                            投稿人<b>*</b></label>
                                        <input name="Author" type="text" class="dfinput" style="width: 518px;" /></li>
                                    <li>
                                        <label>
                                            时间<b>*</b></label><input name="SubDateTime" type="text" class="dfinput" value="@DateTime.Now"  style="width:518px;"/>
                                    </li>
                                    <li>
                                        <label>
                                            新闻类型<b>*</b></label>
                                        <div class="usercity">
                                            <div class="cityleft">
                                                <select name="Category2" id="Category2" class="select2">
                                                    @foreach (KeyValuePair<string, string> a in Graduate_Council.Model.NewsCategory.totalCategory)
                                                    {
                                                        <option value="@a.Key">@a.Value</option>
                                                    }
                                                </select>
                                                <select name="Category" id="Category" class="select2">
                                                    @foreach (string str in Graduate_Council.Model.NewsCategory.newsCategory["FrontNews"])
                                                    {
                                                        <option>@str</option>
                                                    }
                                                </select>
                                                
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <label>
                                            新闻内容<b>*</b></label>
                                        <textarea id="content7" name="Detail" cols="100" rows="8" style="width: 700px; height: 200px;
                                            visibility: hidden;"></textarea>
                                    </li>
                                    <li>
                                        <label>
                                            &nbsp;</label><input type="submit" class="btn" value="添加新闻" /><label>
                                                &nbsp;</label><input type="button" class="btn" onclick="exit()" value="退出" style="padding-right: 25px" />
                                    </li>
                                </ul>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    var map = new Array(8);
    function comefrom(category, subcategory) { this.category = category; this.subcategory = subcategory; }
    map[0] = new comefrom("FrontNews", "学术活动|文体活动|社会实践|校园小记|实事播报|欢迎投稿");
    map[1] = new comefrom("CouncilDynamicNews", "研会动态");
    map[2] = new comefrom("BranchNews", "各分会名称|分会实况|分会链接");
    map[3] = new comefrom("CampusEssay", "校园油记");
    map[4] = new comefrom("NoticeNews", "通知公告");
    map[5] = new comefrom("JobNews", "就业信息");
    map[6] = new comefrom("CouncilExpNews", "精品活动|结构设置|规章制度|研会历史");
    map[7] = new comefrom("DataDownload", "资料下载");
    $("#Category2").change(function () {
        var key = $(this).val();
        var option = "";
        for (i = 0; i < map.length; i++) {
            if (map[i].category == key) {
                var categorys = (map[i].subcategory.split("|"));
                for (x = 0; x < categorys.length; x++) {
                    option += "<option>" + categorys[x] + "</option>";
                }
            }
        }
        $("#Category").empty();
        $("#Category").append(option);

    });
    function AfterSuccess(data) {
        if (data == "ok") {
            alert("投稿成功！");
            window.location.href = "/Home/Index";
        }
        else if (data == "no") {
            alert("信息添加失败！");
        }
        else {
            alert(data);
        }
    };
    function exit() {
        if (confirm("确定要退出么？")) {
            window.location.href = "/Home/Index";
        }
    }    
    </script>
